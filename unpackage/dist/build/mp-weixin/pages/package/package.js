(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/package/package"],{4743:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){Promise.all([o.e("common/vendor"),o.e("components/uni-popup/uni-popup")]).then(function(){return resolve(o("c727"))}.bind(null,o)).catch(o.oe)},n={components:{uniPopup:i},data:function(){return{limit:10,page:1,leftTitle:"庇佑大家心想事成",rightTitle:"西路财神纳珍天尊",imgUrl:"",status:0,tmpImg:"",width:452,height:650,pixelRatio:2,bgPath:"/static/tmp/pbg.png",codePath:"/static/tmp/code.jpg",shareInfo:{title:"",poser:""},packageList:[],detail:{}}},computed:{bgImage:function(){return"url(".concat(this.imgUrl,")")}},onLoad:function(e){var o=this;wx.getSystemInfo({success:function(t){o.width=226*t.pixelRatio,o.height=325*t.pixelRatio,o.pixelRatio=t.pixelRatio}}),this.getShareInfo(),this.getPackage(),this.detail=JSON.parse(e.detail),this.imgUrl=this.detail.main_image,t.getStorage({key:"name",success:function(t){o.leftTitle="庇佑"+t.data+"心想事成",o.rightTitle=o.detail.info.substr(0,8)}}),console.log(e),e.status?this.status=1:e.expired?(this.open(),this.status=0):this.status=0},onShareAppMessage:function(t){return"button"===t.from&&console.log(t.target),{title:this.shareInfo.title,path:"/pages/index/index"}},methods:{jin:function(){var e=t.getStorageSync("paryData").id;this.$api.put("/api/prayer/"+e).then((function(e){t.showToast({title:"上香成功",icon:"none"})}))},getPackage:function(){var t=this;this.$api.get("/api/pray",{params:{limit:this.limit,page:this.page}}).then((function(e){console.log(e),t.packageList=t.packageList.concat(e.data)}))},getShareInfo:function(){var t=this;this.$api.get("/api/user/share").then((function(e){console.log(e),t.shareInfo=e}))},closePoser:function(){this.$refs.poster.close()},getPoster:function(){var e=this;this.$refs.share.close(),t.showLoading({title:"海报生成中..."});var o=this,i=wx.createCanvasContext("myCanvas");i.width=this.width,i.height=this.height;i.width;wx.getImageInfo({src:this.shareInfo.poser,success:function(n){console.log(n),i.drawImage(e.bgPath,0,0,e.width,e.height),i.drawImage(n.path,0,0,226*e.pixelRatio,210*e.pixelRatio),i.setFontSize(12*e.pixelRatio),i.setFillStyle("#935C41"),i.setTextAlign("center");var a=e.shareInfo.title;a.length>16&&(a=a.substr(0,16)+"..."),i.fillText(a,e.width/2,226*e.pixelRatio),i.save(),i.restore(),wx.getImageInfo({src:o.codePath,success:function(n){i.drawImage(o.codePath,13*o.pixelRatio,258*o.pixelRatio,52*o.pixelRatio,52*o.pixelRatio),i.save(),i.restore(),i.draw(),setTimeout((function(){wx.canvasToTempFilePath({canvasId:"myCanvas",x:0,y:0,width:e.width,height:e.height,destWidth:e.width,destHeight:e.height,success:function(o){var i=o.tempFilePath;e.tmpImg=i,console.log(i),t.hideLoading(),e.$refs.poster.open()},fail:function(e){console.log(e),t.hideLoading()}})}),300)}})}})},saveImageToPhotosAlbum:function(){var t=this,e=t.tmpImg;void 0!=e&&""!=e&&wx.saveImageToPhotosAlbum({filePath:e,success:function(t){wx.showToast({title:"已保存到相册",icon:"none",duration:1500,mask:!0})},fail:function(t){console.error(t),console.error("打开设置窗口"),wx.openSetting({success:function(t){console.error(t),t.authSetting["scope.writePhotosAlbum"]?console.error("获取权限成功，再次点击图片保存到相册"):console.error("获取权限失败")}})}})},showShare:function(){this.$refs.share.open()},goBack:function(){t.reLaunch({url:"/pages/index/index"})},open:function(){this.$refs.popup.open()},close:function(){this.status=0,this.$refs.popup.close()},wxPay:function(e){var o=this;t.showLoading({title:"加载中",mask:!0}),wx.login({success:function(i){i.code?o.$api.post("/api/wechat/pay",{dojo_id:o.detail.id,pray_id:e,prayer_id:t.getStorageSync("paryData").id}).then((function(e){console.log(e),wx.requestPayment({appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(e){console.log(e),console.log("支付成功"),t.showToast({title:"支付成功",duration:1200}),o.status=1},fail:function(e){console.log("支付失败"),t.showToast({title:"支付失败",icon:"none",duration:1200})},complete:function(e){t.hideLoading()}})})):console.log("登录失败！"+i.errMsg)}})}}};e.default=n}).call(this,o("543d")["default"])},5019:function(t,e,o){},"82de":function(t,e,o){"use strict";var i=o("5019"),n=o.n(i);n.a},"894e":function(t,e,o){"use strict";o.r(e);var i=o("fe6c"),n=o("f57a");for(var a in n)"default"!==a&&function(t){o.d(e,t,(function(){return n[t]}))}(a);o("82de");var s,c=o("f0c5"),r=Object(c["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);e["default"]=r.exports},cb52:function(t,e,o){"use strict";(function(t){o("e486");i(o("66fd"));var e=i(o("894e"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},f57a:function(t,e,o){"use strict";o.r(e);var i=o("4743"),n=o.n(i);for(var a in i)"default"!==a&&function(t){o.d(e,t,(function(){return i[t]}))}(a);e["default"]=n.a},fe6c:function(t,e,o){"use strict";var i={uniPopup:function(){return Promise.all([o.e("common/vendor"),o.e("components/uni-popup/uni-popup")]).then(o.bind(null,"c727"))}},n=function(){var t=this,e=t.$createElement;t._self._c},a=[];o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return a})),o.d(e,"a",(function(){return i}))}},[["cb52","common/runtime","common/vendor"]]]);