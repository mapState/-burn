(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/package/package"],{4743:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){Promise.all([i.e("common/vendor"),i.e("components/uni-popup/uni-popup")]).then(function(){return resolve(i("c727"))}.bind(null,i)).catch(i.oe)},n={components:{uniPopup:o},data:function(){return{limit:10,page:1,leftTitle:"庇佑大家心想事成",rightTitle:"西路财神纳珍天尊",imgUrl:"",status:0,tmpImg:"",width:452,height:650,pixelRatio:2,bgPath:"/static/tmp/pbg.png",codePath:"/static/tmp/code.jpg",shareInfo:{title:"",poser:""},packageList:[],detail:{}}},computed:{bgImage:function(){return"url(".concat(this.imgUrl,")")}},onLoad:function(e){var i=this;wx.getSystemInfo({success:function(t){i.width=226*t.pixelRatio,i.height=325*t.pixelRatio,i.pixelRatio=t.pixelRatio}}),this.getShareInfo(),this.getPackage();try{var o=JSON.parse(e.detail);o.content=decodeURIComponent(o.content),this.detail=o,this.rightTitle=this.detail.info.substr(0,8)}catch(n){}t.getStorage({key:"name",success:function(t){i.leftTitle="庇佑"+t.data+"心想事成"}}),console.log(e),e.status?(this.status=1,this.imgUrl=this.detail.pray_image):e.expired?(this.open(),this.status=0,this.imgUrl=this.detail.pay_image):(this.status=0,this.imgUrl=this.detail.pay_image)},onShow:function(){wx.hideHomeButton()},onShareAppMessage:function(t){return"button"===t.from&&console.log(t.target),{title:this.shareInfo.title,path:"/pages/index/index"}},methods:{jin:function(){var e=this,i=t.getStorageSync("paryData").id;this.$api.put("/api/prayer/"+i).then((function(e){console.log(e),t.showToast({title:"上香成功",icon:"none"})})).catch((function(t){console.log(t),500==t.code&&(e.open(),e.status=0,e.imgUrl=e.detail.pay_image)}))},getPackage:function(){var t=this;this.$api.get("/api/pray",{params:{limit:this.limit,page:this.page}}).then((function(e){console.log(e),t.packageList=t.packageList.concat(e.data)}))},getShareInfo:function(){var t=this;this.$api.get("/api/user/share").then((function(e){console.log(e),t.shareInfo=e}))},closePoser:function(){this.$refs.poster.close()},getPoster:function(){var e=this;this.$refs.share.close(),t.showLoading({title:"福报生成中..."});var i=this,o=wx.createCanvasContext("myCanvas");o.width=this.width,o.height=this.height;o.width;wx.getImageInfo({src:this.shareInfo.poser,success:function(n){console.log(n),o.drawImage(e.bgPath,0,0,e.width,e.height),o.drawImage(n.path,0,0,226*e.pixelRatio,210*e.pixelRatio),o.setFontSize(12*e.pixelRatio),o.setFillStyle("#935C41"),o.setTextAlign("center");var a=e.shareInfo.title;a.length>16&&(a=a.substr(0,16)+"..."),o.fillText(a,e.width/2,226*e.pixelRatio),o.save(),o.restore(),wx.getImageInfo({src:i.codePath,success:function(n){o.drawImage(i.codePath,13*i.pixelRatio,258*i.pixelRatio,52*i.pixelRatio,52*i.pixelRatio),o.save(),o.restore(),o.draw(),setTimeout((function(){wx.canvasToTempFilePath({canvasId:"myCanvas",x:0,y:0,width:e.width,height:e.height,destWidth:e.width,destHeight:e.height,success:function(i){var o=i.tempFilePath;e.tmpImg=o,console.log(o),t.hideLoading(),e.$refs.poster.open()},fail:function(e){console.log(e),t.hideLoading()}})}),300)}})}})},saveImageToPhotosAlbum:function(){var t=this,e=t.tmpImg;void 0!=e&&""!=e&&wx.saveImageToPhotosAlbum({filePath:e,success:function(t){wx.showToast({title:"已保存到相册",icon:"none",duration:1500,mask:!0})},fail:function(t){console.error(t),console.error("打开设置窗口"),wx.openSetting({success:function(t){console.error(t),t.authSetting["scope.writePhotosAlbum"]?console.error("获取权限成功，再次点击图片保存到相册"):console.error("获取权限失败")}})}})},showShare:function(){this.$refs.share.open()},goBack:function(){t.reLaunch({url:"/pages/index/index"})},open:function(){this.$refs.popup.open()},close:function(){this.status=0,this.imgUrl=this.detail.pay_image,this.$refs.popup.close()},wxPay:function(e){var i=this;t.showLoading({title:"加载中",mask:!0}),wx.login({success:function(o){o.code?i.$api.post("/api/wechat/pay",{dojo_id:i.detail.id,pray_id:e,prayer_id:t.getStorageSync("paryData").id}).then((function(e){console.log(e),wx.requestPayment({appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(e){console.log(e),console.log("支付成功"),t.showToast({title:"支付成功",duration:1200}),i.status=1,i.imgUrl=i.detail.pray_image},fail:function(e){console.log("支付失败"),t.showToast({title:"支付失败",icon:"none",duration:1200})},complete:function(e){t.hideLoading()}})})):console.log("登录失败！"+o.errMsg)}})}}};e.default=n}).call(this,i("543d")["default"])},"4d74":function(t,e,i){"use strict";var o={uniPopup:function(){return Promise.all([i.e("common/vendor"),i.e("components/uni-popup/uni-popup")]).then(i.bind(null,"c727"))}},n=function(){var t=this,e=t.$createElement;t._self._c},a=[];i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return o}))},5019:function(t,e,i){},"82de":function(t,e,i){"use strict";var o=i("5019"),n=i.n(o);n.a},"894e":function(t,e,i){"use strict";i.r(e);var o=i("4d74"),n=i("f57a");for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);i("82de");var s,c=i("f0c5"),r=Object(c["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=r.exports},cb52:function(t,e,i){"use strict";(function(t){i("e486");o(i("66fd"));var e=o(i("894e"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},f57a:function(t,e,i){"use strict";i.r(e);var o=i("4743"),n=i.n(o);for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);e["default"]=n.a}},[["cb52","common/runtime","common/vendor"]]]);